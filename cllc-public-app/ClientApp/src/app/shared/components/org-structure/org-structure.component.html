<h1 *ngIf="node?.isRoot" class="plain-header">{{node?.businessNameNew}} Detailed Organization Information</h1>
<div *ngIf="node?.isRoot" class=row>
    <div class="col-md-12">

        <section class="d-flex">
            <div class="flex-grow-0" style="width: 50px; background-color: #E1E8F2;"></div>
            <div class="flex-grow-1 p-3" style="background-color: #F1F4FA; padding: 20px;">

              <p>All licensees and applicants must maintain a complete and current list of key personnel and businesses associated with their organization.</p> 
              <p>You are required to notify the LCRB of any changes to your organizationâ€™s structure within ten business days of the change being made. These changes include:</p>
                  <ul><li>Change of directors, officers, or senior managers</li>
                  <li>Name changes</li>
                  <li>Internal transfer of shares</li>
                  <li>External transfer of shares</li>
                  </ul>
              <p><b>Please note:</b> Licence transfers to a different legal entity may be requested through the Licences dashboard.</p>
                  
              <p>Fees are calculated based on the type of change reported and the number of licences impacted. If no changes are made, or no licences are held, you will not be charged a fee for submitting this information.</p>
              <ul>
                <li>Applicable fees for cannabis licensees are listed in <a href="http://www.bclaws.ca/civix/document/id/complete/statreg/202_2018#Schedule1" target="_blank">Schedule 1</a> of the Cannabis Licensing Regulation.</li>
                <li>Applicable fees for liquor licensees are listed in <a href="http://www.bclaws.ca/civix/document/id/complete/statreg/241_2016#Schedule1" target="_blank">Schedule 1</a> of the Liquor Control and Licensing Regulation.</li>
              </ul>
            </div>
          </section>
      </div>
</div>
<h2 *ngIf="!node?.isRoot && node?.businessType" class="plain-header">
  {{node?.businessNameNew}} Shareholder Business Information </h2>
<p *ngIf="!node?.isRoot && !node?.businessType">Please select a shareholder <strong>Business Type</strong> above.</p>

<ng-template #treeNode let-node="node" let-account="account">

  <ng-container *ngIf="node?.businessType === 'PrivateCorporation' || node?.businessType === 'PublicCorporation'">
    <h3 class="blue-header">Provide Corporate Documents</h3>
    <h3 class="plain-header">Notice of Articles</h3>
    <section class="padded-section">
      <p>Please upload the {{node?.businessNameNew}} Corporation Notice of Articles.</p>
      <section>
        <app-file-uploader *ngIf="account?.id" documentType="{{asLicenseeChangeLog(node).fileUploadPrefix}} NOA"
          fileTypes="FILE MUST BE IN PDF FORMAT." [multipleFiles]="false" entityName="account"
          [useDocumentTypeForName]="true"
          (numberOfUploadedFiles)="updateNumberOfFiles($event, 'NOA')"
          [entityId]="account?.id" [uploadHeader]="'TO UPLOAD NOTICE OF ARTICLES, DRAG FILE HERE OR'">
        </app-file-uploader>
      </section>
    </section>
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'PrivateCorporation'" [formGroup]="form">
    <h3 class="plain-header">Central Securities Register</h3>
    <section class="padded-section">
      <p>Please upload the {{node?.businessNameNew}} Central Securities Register.</p>
      <app-file-uploader *ngIf="account?.id" documentType="{{asLicenseeChangeLog(node).fileUploadPrefix}} SECREG"
        fileTypes="FILE MUST BE IN PDF FORMAT." [multipleFiles]="false" entityName="account"
        (numberOfUploadedFiles)="updateNumberOfFiles($event, 'SECREG')"
        [useDocumentTypeForName]="true" (numberOfUploadedFiles)="uploadedFinancialIntegrityDocuments = $event"
        [entityId]="account?.id" [uploadHeader]="'TO UPLOAD CENTRAL SECURITIES REGISTER, DRAG FILE HERE OR'">
      </app-file-uploader>
    </section>

    <h3 class="plain-header">Special Rights and Restrictions</h3>
    <section class="padded-section">
      <p>If the corporation has special rights and restrictions not described within the Notice of Article, please
        provide them here.
      </p>
      <app-file-uploader *ngIf="account?.id" documentType="{{asLicenseeChangeLog(node).fileUploadPrefix}} SRANDR"
        fileTypes="FILE MUST BE IN PDF FORMAT." [multipleFiles]="false" entityName="account"
        (numberOfUploadedFiles)="updateNumberOfFiles($event, 'SRANDR')"
        [useDocumentTypeForName]="true" (numberOfUploadedFiles)="uploadedFinancialIntegrityDocuments = $event"
        [entityId]="account?.id" [uploadHeader]="'TO UPLOAD SPECIAL RIGHTS AND RESTRICTIONS, DRAG FILE HERE OR'">
      </app-file-uploader>
      <app-field label="Total Number of Voting Shares" errorMessage="Please enter value"
      [valid]="!form.get('totalShares').touched || form.get('totalShares').touched">
      <input type="number" formControlName="totalShares" class="form-control">
      </app-field>
    </section>

  </ng-container>

  <ng-container *ngIf="node?.businessType === 'Partnership'">
    <h3 class="blue-header">Provide Partnership Documents</h3>
    <h3 class="plain-header">Partnership Agreement</h3>
    <section class="padded-section">
      <p>Partnership Agreement for {{node?.businessNameNew}}.</p>
      <app-file-uploader *ngIf="account?.id"
        documentType="{{asLicenseeChangeLog(node).fileUploadPrefix}} Partnership Agreement"
        fileTypes="FILE MUST BE IN PDF FORMAT." [multipleFiles]="false" entityName="account"
        (numberOfUploadedFiles)="updateNumberOfFiles($event, 'Partnership Agreement')"
        [useDocumentTypeForName]="true" (numberOfUploadedFiles)="uploadedFinancialIntegrityDocuments = $event"
        [entityId]="account?.id" [uploadHeader]="'TO UPLOAD SPECIAL PARTNERSHIP AGREEMENT, DRAG FILE HERE OR'">
      </app-file-uploader>
    </section>
  </ng-container>

  <ng-container [formGroup]="form" *ngIf="node?.businessType === 'Society'">
    <section class="padded-section">
      <h3 class="blue-header">Provide Society Information</h3>
      <app-field label="Annual Membership Fee" errorMessage="Please enter value"
        [valid]="!form.get('annualMembershipFee').touched || form.get('annualMembershipFee').touched">
        <input type="number" formControlName="annualMembershipFee" class="form-control">
      </app-field>
      <app-field label="Number of Members" errorMessage="Please enter value"
        [valid]="!form.get('numberOfMembers').touched || form.get('numberOfMembers').touched">
        <input type="number" formControlName="numberOfMembers" re class="form-control">
      </app-field>
    </section>
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'SoleProprietor'">
    <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).keyPersonnelChildren" [rootNode]="node"
      [account]="account" (personalHistoryItemsChange)="updateChildred($event, 'Leadership')"
      changeTypeSuffix="Leadership" addLabel="Add Leader">
    </app-associate-list>
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'PrivateCorporation' || node?.businessType === 'PublicCorporation'">

    <h3 class="blue-header">List Key Personnel</h3>
    <section class="padded-section">
      <p>
        Please add the complete list of directors, officers and senior managers for {{node?.businessNameNew}}, including
        their
        full legal name, date of birth and email address. They will be reviewed by the LCRB against your Notice of
        Articles.
        In order to complete an application for a liquor or cannabis licence, they will each be required to provide
        security screening
        related information.
      </p>
      <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).keyPersonnelChildren" [rootNode]="node" 
        [account]="account" (personalHistoryItemsChange)="updateChildred($event, 'Leadership')" [licencesOnFile]="licencesOnFile"
        changeTypeSuffix="Leadership" addLabel="Add Key Personnel"></app-associate-list>
    </section>
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'Society'">
    <h3 class="blue-header">List Directors and Officers</h3>
    <section class="padded-section">
      <p>
        Please add the complete list of directors and officers for {{node?.businessNameNew}}, including their
        full legal name, date of birth and email address. In order to complete an application for a liquor or cannabis
        licence, they will each be
        required to provide security screening related information.
      </p>
      <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).keyPersonnelChildren"  [licencesOnFile]="licencesOnFile"
        (personalHistoryItemsChange)="updateChildred($event, 'Leadership')" [rootNode]="node" [account]="account"
        changeTypeSuffix="Leadership" addLabel="Add Director or Officer"></app-associate-list>
    </section>
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'Partnership'">
    <h3 class="blue-header">List Partners</h3>
    <h4 class="plain-header">Individual Partners</h4>
    <section class="padded-section">
      <p>
        Please add the complete list of partners for {{node?.businessNameNew}}, including their
        full legal name, date of birth, email address and percentage of ownership. They will be checked by LCRB against
        the partnership agreement provided.
        In order to complete an application for a liquor or cannabis licence, they will each be required to provide
        security screening
        related information.
      </p>
      <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).individualShareholderChildren"  [licencesOnFile]="licencesOnFile"
        (personalHistoryItemsChange)="updateChildred( $event, 'IndividualShareholder')" [rootNode]="node" [account]="account"
        changeTypeSuffix="IndividualShareholder" addLabel="Add Individual Partner"></app-associate-list>
    </section>

    <h4 class="plain-header">Business Partners</h4>
    <section class="padded-section">
      <p>
        Please list any business partners including their name, type of business, percentage of shares owned, and
        email address. Depending on
        the type of business partner, additional supporting documents will be required.
      </p>
      <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).businessShareholderChildren"
        [rootNode]="node" [account]="account"  [licencesOnFile]="licencesOnFile"
        (personalHistoryItemsChange)="updateChildred($event, 'BusinessShareholder')"
        changeTypeSuffix="BusinessShareholder" addLabel="Add Business Partner"></app-associate-list>
    </section>
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'PrivateCorporation'">
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'Society'">
  </ng-container>

  <ng-container *ngIf="node?.businessType === 'PrivateCorporation'">
    <h3 class="blue-header">Identify Shareholders</h3>
    <h4 class="plain-header">Individual Shareholders</h4>
    <section class="padded-section">
      <p>
        Please list any individual shareholders including their full legal name, date of birth, number of voting shares
        owned, and email address.
      </p>
      <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).individualShareholderChildren"
        (personalHistoryItemsChange)="updateChildred($event, 'IndividualShareholder')" [rootNode]="node"  [licencesOnFile]="licencesOnFile"
        [account]="account" changeTypeSuffix="IndividualShareholder" addLabel="Add Individual Shareholder">
      </app-associate-list>
    </section>
    <h4 class="plain-header">Business Shareholders</h4>
    <section class="padded-section">

      <p>
        Please list any business shareholders including their name, type of business, number of voting shares owned, and
        email address. Depending on the type of business shareholder, additional supporting documents will be required.
      </p>
      <app-associate-list [personalHistoryItems]="asLicenseeChangeLog(node).businessShareholderChildren"
        [rootNode]="node" [account]="account"  [licencesOnFile]="licencesOnFile"
        (personalHistoryItemsChange)="updateChildred($event, 'BusinessShareholder')"
        changeTypeSuffix="BusinessShareholder" addLabel="Add Business Shareholder"></app-associate-list>
        <p>&nbsp;</p>
    </section>
  </ng-container>
</ng-template>

<ng-container *ngTemplateOutlet="treeNode; context: { node: node, account: account }"></ng-container>