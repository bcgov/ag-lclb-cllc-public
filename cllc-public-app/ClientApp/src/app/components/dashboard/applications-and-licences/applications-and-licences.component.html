<mat-progress-bar class="mt-1 mb-1" *ngIf="!dataLoaded" mode="indeterminate"></mat-progress-bar>

<div>
  <h3 class="blue-header" style="margin-bottom: 0; margin-top: 0;">APPLICATIONS</h3>
  <section style="border: 1px solid #ccc; padding: 10px;  border-bottom: 4px solid #FFCC00;">
    <section>
      <div *ngIf="submittedApplications < 300">
        <p>
          Use the list below to find the application type you are looking for:
        </p>

        <section *ngIf="!marketerExists">
          <h3>CANNABIS LICENCE APPLICATIONS</h3>
          <div *ngIf="!(nonMarketerExists || marketerExists) && CRSElligible()">
            <p>
              <i>*You cannot apply for both cannabis licences, you can apply for one or other.</i>
            </p>
          </div>

          <table class="start-application">
            <!-- <tr>
              <th colspan=2>LICENCE</th>
              <th></th>
            </tr> -->
            <tr *ngIf="!(marketerExists) && CRSElligible()">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/Cannabis-store-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">

                <h3>Cannabis Retail Store Licence</h3>
                <p>The cannabis retail store licence allows licensees to sell non-medical cannabis and accessories.</p>
                <P>(A separate application must be submitted for each proposed store)</P>
                <a href="policy-document/cannabis-retail-licence"
                  target="_blank" rel="noopener noreferrer">Learn more about this licence</a>
              </td>
              <td style="text-align: center;">
                <button mat-raised-button color="secodary" [disabled]="startCRSOngoing"
                  (click)="startNewLicenceApplication()" id="startCRS">
                  <span>START APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startCRSOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>
            <tr *ngIf="!(nonMarketerExists || marketerExists)">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">

                <img class="icon" src="assets/Cannabis-marketing-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Cannabis Marketing Licence</h3>
                <p>The Cannabis Marketing Licence allows licensees to promote non-medical cannabis to licensed cannabis
                  retail stores and the adult public.</p>
                <a href="policy-document/cannabis-marketing-licence">Learn
                  more about this licence</a>
              </td>
              <td style="text-align: center;">
                <button mat-raised-button color="secondary" [disabled]="startMarketingOngoing"
                  (click)="startNewMarketerApplication()" id="startMarketing">
                  <span>START APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startMarketingOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>
          </table>
        </section>
        <hr>
        <section>
          <h3>LIQUOR LICENCE APPLICATIONS</h3>
          <table class="start-application">
            <tr>
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/Catering-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Catering Licence</h3>
                <p>Catering licences are for catering businesses that provide a full range of food and beverage services
                  to their clients. Licensed caterers can sell liquor and maintain a liquor inventory. </p>
                <a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/catering-liquor-licence"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style='text-align: center;'>
                <button *ngIf="liquorOne" mat-raised-button color="secondary" [disabled]="startCateringOngoing"
                  (click)="startNewCateringApplication()" id="startCatering">
                  <span>START APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startCateringOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
                <button *ngIf="!liquorOne" mat-raised-button color="secondary" id="startCatering" disabled>COMING
                  SOON</button>
              </td>
            </tr>
            <tr *ngIf="liquorThree">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/food-primary-blue.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Food Primary Licence</h3>
                <p>Food primary licences are for establishments where the primary focus is the service of food such as
                  restaurants,
                  bistros, and cafes. Take-out restaurants, mall food fairs, food trucks, and banquet halls without
                  fully equipped
                  kitchens are not eligible.</p>
                <a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/food-primary-liquor-licence"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style='text-align: center;'>
                <button mat-raised-button color="secondary" [disabled]="startFPOngoing"
                  (click)="startNewFPApplication()" id="startFP">
                  <span>START
                    APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startFPOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>

            <tr *ngIf="liquorTwo">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/Manufacturer-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Manufacturer Licence</h3>
                <p>Any business making wine, cider, beer (this includes brew pubs), or spirits must have a winery,
                  brewery, distillery or co-packer licence from the Liquor and Cannabis Regulation Branch.</p>
                <a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/manufacturer-liquor-licence"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style='text-align: center;'>
                <button mat-raised-button color="secodary" [disabled]="startMfgOngoing"
                  (click)="startNewMfgApplication()" id="startMfg">
                  <span>START APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startMfgOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>

            <tr *ngIf="liquorTwo">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/Licensee-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Licensee Retail Store</h3>
                <p>Often referred to as private liquor stores or cold beer and wine stores, licensee retail stores (LRS)
                  may sell beer,
                  wine, coolers, cider, and a full range of spirits for private consumption. An LRS may also sell
                  packaged snacks,
                  non-alcoholic beverages, B.C. Lottery products, and liquor-related items, such as glasses, bottle
                  openers and
                  corkscrews. </p>
                <a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/licensee-private-retail-store-liquor-licence"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style='text-align: center;'>
                <i>New Licensee Retail Store applications <br>are closed at this time.</i>
              </td>
            </tr>

            <tr *ngIf="liquorThree">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/liquor-primary-bars-blue.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Liquor Primary Licence</h3>
                <p>A Liquor Primary licence is for businesses where the primary purpose is to sell liquor (bars, as well as stadiums, theatres, aircraft, etc.) as well as other businesses that wish to serve liquor as an additional service to their primary business (spas, salons, art galleries, etc).</p>
                <a href="https://www2.gov.bc.ca/assets/gov/employment-business-and-economic-development/business-management/liquor-regulation-licensing/guides-and-manuals/liquorprimary-handbook.pdf"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style='text-align: center;'>
                <button mat-raised-button color="secondary" [disabled]="startLPOngoing"
                  (click)="startNewLPApplication()" id="startLP">
                  <span>START
                    APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startLPOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>

            <tr *ngIf="liquorTwo">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/U-Brew-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>UBrew / UVin Licence</h3>
                <p>Also known as Ferment-on-Premises, UBrews and UVins are businesses that provide their customers
                  with the ingredients, equipment and advice they need to make their own beer, wine, cider or coolers
                  on-site.
                  Once it's made, UBrew and UVin customers must take their liquor away, for their own private
                  consumption.
                  It cannot be sold to others.</p>
                <a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/ubrew-and-uvin-liquor-licence"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style='text-align: center;'>
                <button mat-raised-button color="secondary" [disabled]="startUBVOngoing"
                  (click)="startNewUBVApplication()" id="startUBV">
                  <span>START APPLICATION</span>
                  <mat-progress-bar class="mb-1" *ngIf="startUBVOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>



            <tr>
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/Wine-store-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Wine Retail Store Licence</h3>
                <p>Wine Stores licences allow businesses to sell wine to retail customers. This includes stores
                  associated with a particular winery or group of wineries, independent wine stores, Vintners Quality
                  Alliance (VQA) wine stores and tourist wine stores. They operate as a separate retail store and are
                  not located at a winery. </p>

                <a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/wine-store-liquor-licence"
                  target="_blank">Learn
                  more about this licence</a>
              </td>
              <td style="text-align: center;">
                <i>New wine store applications <br>are closed at this time.</i>
              </td>
            </tr>

            <tr>
              <!-- Apply for a Rural Agency Store Licence -->
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;">
                <img class="icon" src="assets/Wine-store-icon-blue-40px.png" alt="">
              </td>
              <td style="width:700px;">
                <h3>Rural Agency Store Information Submission</h3>
                <p>Existing Rural Agency Stores must submit their store and business information to the LCRB in order to
                  be issued a licence in the future. Note, you will need an existing Rural Agency Store Certificate
                  number to complete the submission. </p>
                <!--a href="https://www2.gov.bc.ca/gov/content/employment-business/business/liquor-regulation-licensing/liquor-licences-permits/applying-for-a-liquor-licence-or-permit/wine-store-liquor-licence"
                  target="_blank">Learn
                  more about this Expression of Interest</a-->
              </td>
              <td style="text-align: center;">
                <button mat-raised-button color="secondary" (click)="startNewRASApplication()" id="startRAS">
                  SUBMIT INFORMATION
                  <mat-progress-bar class="mb-1" *ngIf="startRASOngoing" mode="indeterminate"></mat-progress-bar>
                </button>
              </td>
            </tr>

          </table>
        </section>
      </div>
      <mat-progress-bar class="mt-1" *ngIf="!dataLoaded" mode="indeterminate"></mat-progress-bar>
      <mat-tab-group *ngIf="dataLoaded" [selectedIndex]="0">
        <mat-tab label="In Progress Applications" id="inProgressApplications">
          <section *ngIf="inProgressApplications?.length > 0">
            <label>Please note:</label> <br>
            <p>Due to the high volume of applications, we ask that you limit questions about the status of your
              application
              as much as possible. Answering fewer questions provides us more capacity to process applications.
            </p>
            <p>We will contact you regarding your application as soon as we have an update to communicate, have
              information
              that you will need to know, or are requesting additional information from you.
            </p>
            <p>Thank you for your patience.</p>
          </section>
          <p *ngIf="inProgressApplications?.length == 0 ">
            You do not have any In Progress Applications.
          </p>

          <table *ngIf="inProgressApplications?.length > 0" class="eq-table">
            <tr>
              <th colspan=2>Application</th>
              <!-- <th style="width: 95px">Last Updated</th> -->
              <th style="width: 235px">Status</th>
              <th>Actions</th>
              <th>Apply for Endorsements</th>
            </tr>
            <tr *ngFor="let item of inProgressApplications; let i = index;" style="border: 1px solid #ccc; ">
              <td style="background-color: #E1E8F2; padding: 10px; width: 15px;"><span>{{i+1}}</span></td>
              <td style="background-color: #F1F4FA; padding: 10px; padding-bottom: 15px;">
                <ng-container *ngIf="item.applicationTypeName === ApplicationTypeNames.PermanentChangeToALicensee">
                  <span style="font-weight: 600">{{ApplicationTypeNames.PermanentChangeToALicensee}}</span> <br>
                  <span>Job No: </span> <i>{{item.jobNumber}}</i> <br>
                  <span>Reference #: {{item.name}} </span> <span></span> <br>
                </ng-container>

                <ng-container *ngIf="item.applicationTypeName !== ApplicationTypeNames.PermanentChangeToALicensee">
                  <span style="font-weight: 600">{{item.establishmentName}}</span> <br>
                  <span>{{item.portallabel}}</span> <br>
                  <span>Job No: </span> <i>{{item.jobNumber}}</i> <br>
                  <span>Reference #: {{item.name}} </span> <span></span> <br>
                </ng-container>


              </td>
              <!--
                <td style="padding: 10px; width: 110px;">
                  {{item.modifiedon | date:'mediumDate'}}
                </td>
              -->
              <td style="background-color: #E1E8F2; padding: 10px;">
                <div style="text-transform: uppercase; font-weight: 600;">
                  <span *ngIf="!isApprovedByLGAndNotSubmitted(item)">
                    {{getApplicationStatusText(item.applicationStatus)}}
                  </span>

                  <span *ngIf="isApprovedByLGAndNotSubmitted(item)">
                    Ready for Submission
                  </span>

                </div>
                <p *ngIf="item.applicationStatus === 'Processed'">
                  This application has been received and is being reviewed by the LCRB.
                </p>
                <p *ngIf="item.applicationStatus === 'Not Submitted'">
                  This application has not yet been submitted.
                </p>
                <p *ngIf="item.applicationStatus === 'Relocation Initiated'">
                  This relocation application has not yet been submitted
                </p>
                <p *ngIf="item.applicationStatus === 'Transfer Initiated'">
                  This transfer application has not yet been submitted
                </p>
                <p *ngIf="item.applicationStatus === 'Application Under Review'">
                  Your application has been received and is being reviewed by the LCRB.
                </p>
                <p *ngIf="item.applicationStatus === 'Transfer Application Under Review'">
                  Your transfer application has been received and is being reviewed by the LCRB.
                </p>
                <p *ngIf="item.applicationStatus === 'Relocation Application Under Review'">
                  Your relocation application has been received and is being reviewed by the LCRB.
                </p>
                <p *ngIf="item.applicationStatus === 'Pending Licence Fee'">

                  <a href="javascript:void(0);" (click)="payLicenceFee(item)" class="missing">
                    <span>
                      <fa-icon [icon]="faShoppingCart" style="margin-right: 10px;"></fa-icon>
                      Pay First Year Fee
                    </span>
                  </a>

                </p>

                <p *ngIf="item.applicationStatus === 'Application Incomplete'">
                  Your application is incomplete. You must provide additional information for it to be processed.
                </p>
                <p *ngIf="item.applicationStatus === 'Pending External Review'">
                  <span *ngIf="!item.lgHasApproved">
                    Your application has been sent for local government review.
                  </span>
                  <span *ngIf="item.lgHasApproved">
                    Your application has been reviewed by the local government.
                  </span>
                </p>
              </td>
              <td style="background-color: #E1E8F2; padding: 10px;">
                <div *ngIf="item.applicationStatus === 'Not Submitted' || item.applicationStatus ===  'Pending External Review'">

                  <ng-container *ngIf="!item.lgHasApproved">
                    <a appRemoveIfFeatureOff="LicenseeChanges"
                      *ngIf="item.applicationTypeName !== ApplicationTypeNames.CRSRenewal && item.applicationTypeName !== ApplicationTypeNames.LiquorRenewal"
                      [routerLink]="getApplicationLink(item)" id="completeApp{{item.id}}">
                      <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                      <span>Complete Application</span>
                    </a>
                  </ng-container>

                  <ng-container *ngIf="item.lgHasApproved">
                    <a appRemoveIfFeatureOff="LicenseeChanges"
                      *ngIf="item.applicationTypeName !== ApplicationTypeNames.CRSRenewal && item.applicationTypeName !== ApplicationTypeNames.Catering && item.applicationTypeName !== ApplicationTypeNames.LiquorRenewal"
                      routerLink="/multi-step-application/post-lg-decision/{{item.id}}" id="completeApp{{item.id}}">
                      <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                      <span>Complete Application</span>
                    </a>
                    <a appRemoveIfFeatureOff="LicenseeChanges"
                      *ngIf="item.applicationTypeName !== ApplicationTypeNames.CRSRenewal && item.applicationTypeName === ApplicationTypeNames.Catering"
                      [routerLink]="['/multi-step-application/post-lg-decision/' + item.id]"
                      id="completeApp{{item.id}}">
                      <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                      <span>Complete Application</span>
                    </a>
                  </ng-container>

                  <a appRemoveIfFeatureOn="LicenseeChanges"
                    *ngIf="item.applicationTypeName !== ApplicationTypeNames.CRSRenewal"
                    routerLink="/account-profile/{{item.id}}" id="completeApp{{item.id}}">
                    <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Complete Application</span>
                  </a>

                  <a *ngIf="item.applicationTypeName === ApplicationTypeNames.CRSRenewal || item.applicationTypeName === ApplicationTypeNames.LiquorRenewal || item.applicationTypeName === ApplicationTypeNames.MarketingRenewal"
                    routerLink="/renew-licence/{{getRenewalType(item.applicationTypeName)}}/{{item.id}}">
                    <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Complete Renewal</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Relocation Initiated'">
                  <a [routerLink]="['/account-profile/' + item.id, { mode: CHANGE_OF_LOCATION_MODE }]">
                    <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Complete Relocation</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Transfer Initiated'">
                  <a routerLink="/multi-step-application/{{item.id}}">
                    <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Complete Transfer</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Licensee Change Initiated'">
                  <a [routerLink]="['/licensee-changes/' + item.id]">
                    <fa-icon [icon]="faPencilAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Complete Licensee Change</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Not Submitted'" style="margin-top: 5px;"
                  (click)="cancelApplication(item.id, item.establishmentName, item.name)">
                  <a href="javascript: void(0)">
                    <fa-icon [icon]="faTrashAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Cancel Application</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Relocation Initiated'" style="margin-top: 5px;"
                  (click)="cancelApplication(item.id, item.establishmentName, item.name)">
                  <a href="javascript: void(0)">
                    <fa-icon [icon]="faTrashAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Cancel Relocation</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Transfer Initiated'" style="margin-top: 5px;"
                  (click)="cancelApplication(item.id, item.establishmentName, item.name)">
                  <a href="javascript: void(0)">
                    <fa-icon [icon]="faTrashAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Cancel Transfer</span>
                  </a>
                </div>

                <div *ngIf="item.applicationStatus === 'Licensee Change Initiated'" style="margin-top: 5px;"
                  (click)="cancelApplication(item.id, item.establishmentName, item.name)">
                  <a href="javascript: void(0)">
                    <fa-icon [icon]="faTrashAlt" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Cancel Licensee Change</span>
                  </a>
                </div>

                <div
                  *ngIf="['Relocation Application Under Review','Transfer Application Under Review', 'Application Under Review', 'Processed'].indexOf(item.applicationStatus) !== -1">
                  <a style="margin-top: 5px;" href="javascript:void(0);" (click)="uploadMoreFiles(item)">
                    <fa-icon [icon]="faPlus" style="color: #1a5a96; margin-right: 10px;"></fa-icon>
                    <span>Add Supporting Documents</span>
                  </a>
                </div>

              </td>
              <td>
                <section *ngIf="item?.endorsements?.length">
                  <!--p>Third Party Operator Application</p-->
                  <ul>
                    <li *ngFor="let appType of item.endorsements">
                      <a href="javascript:void(0)" (click)="startEndorsementApplication(item, appType)">{{appType}}</a>
                    </li>
                  </ul>
                </section>
              </td>
            </tr>
          </table>
          <p></p>
        </mat-tab>
      </mat-tab-group>
    </section>

  </section>
</div>
