<div class="form-wrapper" style="position: relative;">
  <div [ngBusy]="busy"></div>

  <div class="row">
    <h1>Monthly Federal Tracking Report <ng-container *ngIf="selectedLicence">for {{ selectedLicence.establishmentName }}</ng-container></h1>
  </div>

  <form [formGroup]="metaForm" style="width: 100%">
    <div class="form-group row" style="width: 100%">
      <label class="col-md-2 col-form-label">Licence:</label>
      <div class="col-md-3">
        <select class="form-control" formControlName="licence" (change)="licenceChanged($event);">
          <option value="">Choose the licence</option>
          <option *ngFor="let licence of licenses" [value]="licence.licenseId">{{ licence.licenseNumber  }} - {{ licence.establishmentName }}</option>
        </select>
      </div>
    </div>
    <div class="form-group row" *ngIf="metaForm.get('licence').valid" style="width: 100%">
      <label class="col-md-2 col-form-label">Reporting Period:</label>
      <div class="col-md-3">
        <select class="form-control" formControlName="period" (change)="periodChanged($event);">
          <option value="">Choose the reporting period</option>
          <option *ngFor="let report of monthlyReports" [value]="report.monthlyReportId">{{ report.reportingPeriodMonth }} - {{ report.reportingPeriodYear }}</option>
        </select>
      </div>
      <div class="col-md-4 col-xs-12" *ngIf="selectedMonthlyReport">
        <p>Status: <span style="margin-left: 10px; font-weight: bold;">{{monthlyReportStatusEnum[selectedMonthlyReport.statusCode] | uppercase}}</span>
          <i data-html="true" style="color: #38598a; margin-left: 10px;" class="fas fa-question-circle" matTooltipClass="multiline-tooltip" matTooltip="DRAFT: The monthly report has not be completed&#13;SUBMITTED: The monthly report has been completed and is ready to be sent to CTLS&#13;CLOSED: The monthly report has been sent to CTLS"></i>
        </p>
      </div>
    </div>
  </form>

  <form [formGroup]="reportForm" *ngIf="selectedMonthlyReport">
    <div class="employee-reporting">
      <div class="row">
        <h3 class="blue-header col-xs-12">Part 1 - Employee Reporting</h3>
      </div>
      <p>Enter the number of employees who worked at your store under each positions listed below in the previous month.</p>
      <div class="form-group row" style="width: 100%">
        <label class="col-md-2 col-form-label">Management:</label>
        <div class="col-md-1">
          <input class="form-control" type="number" min="0" step="1" pattern="\d*" formControlName="employeesManagement">
        </div>
      </div>
      <div class="form-group row" style="width: 100%">
        <label class="col-md-2 col-form-label">Administrative:</label>
        <div class="col-md-1">
          <input class="form-control" type="number" min="0" step="1" pattern="\d*" formControlName="employeesAdministrative">
        </div>
      </div>
      <div class="form-group row" style="width: 100%">
        <label class="col-md-2 col-form-label">Sales:</label>
        <div class="col-md-1">
          <input class="form-control" type="number" min="0" step="1" pattern="\d*" formControlName="employeesSales">
        </div>
      </div>
      <div class="form-group row" style="width: 100%">
        <label class="col-md-2 col-form-label">Production:</label>
        <div class="col-md-1">
          <input class="form-control" type="number" min="0" step="1" pattern="\d*" formControlName="employeesProduction">
        </div>
      </div>
      <div class="form-group row" style="width: 100%">
        <label class="col-md-2 col-form-label">Other:</label>
        <div class="col-md-1">
          <input class="form-control" type="number" min="0" step="1" pattern="\d*" formControlName="employeesOther">
        </div>
      </div>
    </div>
    <div class="product-selection">
      <div class="row">
        <h3 class="blue-header col-xs-12">Part 2 - Cannabis Product Inventory</h3>
      </div>
      <p>Identify the cannabis products you have ordered, sold, returned or have managed the inventory of in the previous month.</p>
      <div class="form-check" *ngFor="let inventoryReport of selectedMonthlyReport.inventorySalesReports">
        <input class="form-check-input" type="checkbox"
          [checked]="visibleInventoryReports.indexOf(inventoryReport.inventoryReportId) > -1"
          (change)="toggleProductVisibility(inventoryReport.inventoryReportId)"
          id="{{inventoryReport.inventoryReportId}}-check">
        <label class="form-check-label" for="{{inventoryReport.inventoryReportId}}-check">
          {{inventoryReport.product}}
        </label>
      </div>
    </div>
    <div class="product-reporting">
      <div class="row">
        <h3 class="blue-header col-xs-12">Part 3 - Cannabis Product Inventory Details</h3>
      </div>
      <p *ngIf="visibleInventoryReports.length > 0">Enter the inventory details of the cannabis product inventory you identified above:</p>
      <p *ngIf="visibleInventoryReports.length === 0">You have not identified any cannabis product inventory to report in the previous month.</p>
      <ng-container *ngFor="let inventoryReport of visibleInventoryReports">
        <app-product-inventory-sales-report
          [productForm]="findProductForm(inventoryReport)"
        ></app-product-inventory-sales-report>
      </ng-container>
    </div>
    <div class="submit">
      <div class="row" *ngIf="!reportIsDisabled">
        <button class="btn btn-primary" (click)="save(false)">
          <span>
            <i class="fa fa-save" style="color: #fff;"></i>
            SAVE FOR LATER
          </span>
        </button>
        <button class="btn btn-primary" (click)="save(true)">SUBMIT</button>
      </div>
      <div class="row" *ngIf="reportIsDisabled && !reportIsClosed">
        <button class="btn btn-primary" (click)="save(false)">UNSUBMIT</button>
      </div>
    </div>
  </form>
</div>
