<div class="form-wrapper" style="position: relative;">
  <div [ngBusy]="[busy]"></div>
  <form [formGroup]="eventForm" (change)="handleFormChange()">
    <div class="padded-section">
      <h1>Safety and Security Plan</h1>
    </div>

    <div class="padded-section">
      <p>Given the nature of your Catered Event Authorization request, a safety and security plan is required.</p>
    </div>

    <h3 class="blue-header">EVENT DESCRIPTION AND LAYOUT</h3>
    <div class="padded-section clearfix">
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Please describe the areas where liquor will be consumed (e.g. tent, insane the whole hall, etc.):" [required]="true"
        [valid]="eventForm.get('contactName').valid || !eventForm.get('contactName').touched"
        errorMessage="Please enter a description" [isFullWidth]="true">
        <textarea class="form-control" formControlName="eventTypeDescription"></textarea>
      </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="File" [required]="true"
          [valid]="eventForm.get('contactPhone').valid || !eventForm.get('contactPhone').touched"
          errorMessage="Please enter the contact phone number" [isFullWidth]="true">
        <p>Please attach a sketch/diagram of your event showing the following:</p>
        <ol type="a">
          <li>The perimeter of the whole event, not just the liquor service area</li>
          <li>The location, size, and perimeter of the liquor service area (if different from the whole event)</li>
          <li>Exits and entraces - including where ID is checked (for the whole event and for the liquor service area)</li>
          <li>Location of ticket sales (for entrance and for drinks)</li>
          <li>Event focus (location of entertainment / stage, sports activities, displays, etc.)</li>
          <li>Other amenities, concession stands, bike storage, washroom facilities, first aid</li>
        </ol>
        <input class="form-control" type="text" formControlName="contactPhone" mask="(000) 000-0000">
      </app-field>
      </div>
    </div>

    <h3 class="blue-header">NOTIFICATIONS</h3>
    <div class="padded-section">
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Email"
          [valid]="eventForm.get('contactEmail').valid || !eventForm.get('contactEmail').touched"
          [isFullWidth]="true">
          <input class="form-control" type="text" formControlName="contactEmail" readonly>
        </app-field>
      </div>
      <p>To update this email address, please see your Account Profile</p>
    </div>

    <h3 class="blue-header">EVENT DETAILS</h3>
    <div class="padded-section clearfix">
      <p>An event will need approval if it meets any of the following conditions:</p>
      <ul>
        <li>Attendance exceeds 500 people (including staff)</li>
        <li>The event is outdoors</li>
        <li>The duration of liquor service exceeds 2 hours (exludes community events)</li>
      </ul>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Class" [isFullWidth]="true">
          <input class="form-control" type="text" [value]="getEventClassLabel()" readonly>
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Type" [required]="true"
          [valid]="eventForm.get('eventType').valid || !eventForm.get('eventType').touched"
          errorMessage="Please enter the type of event" [isFullWidth]="true">
          <select class="form-control" formControlName="eventType">
            <option *ngFor="let item of eventType" [ngValue]="item.value">{{item.label}}</option>
          </select>

        </app-field>
        <i style="color: #38598a; margin-left: 5px; margin-top:30px;" class="fas fa-question-circle"
        matTooltip="Select the type of event that you are catering." ></i>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Description" [required]="true"
          [valid]="eventForm.get('eventTypeDescription').valid || !eventForm.get('eventTypeDescription').touched"
          errorMessage="Please enter a description of the event" [isFullWidth]="true">
          <textarea class="form-control" formControlName="eventTypeDescription"></textarea>
        </app-field>
        <i style="color: #38598a; margin-left: 5px; margin-top:30px;" class="fas fa-question-circle"
        matTooltip="Briefly describe the event." ></i>

      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Client or Host Name" [required]="true"
          [valid]="eventForm.get('clientHostname').valid || !eventForm.get('clientHostname').touched"
          errorMessage="Please enter the client or host name" [isFullWidth]="true">
          <input class="form-control" type="text" formControlName="clientHostname">
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Maximum Attendance" [required]="true"
          [valid]="eventForm.get('maxAttendance').valid || !eventForm.get('maxAttendance').touched"
          errorMessage="Please enter the maximum attendance (must be a number)" [isFullWidth]="true">
          <input class="form-control" type="number" formControlName="maxAttendance">
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Maximum Staff Attendance" [required]="true"
          [valid]="eventForm.get('maxStaffAttendance').valid || !eventForm.get('maxStaffAttendance').touched"
          errorMessage="Please enter the maximum staff attendance (must be a number)" [isFullWidth]="true">
          <input class="form-control" type="number" formControlName="maxStaffAttendance">
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Minors Attending" [required]="true"
          [valid]="eventForm.get('minorsAttending').valid || !eventForm.get('minorsAttending').touched"
          errorMessage="Please indicate if minors are attending" [isFullWidth]="true">
          <select class="form-control" formControlName="minorsAttending">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Food Service Provided" [required]="true"
          [valid]="eventForm.get('foodService').valid || !eventForm.get('foodService').touched"
          errorMessage="Please enter food service provided" [isFullWidth]="true">
          <select class="form-control" formControlName="foodService" (change)="clearRelatedFormFieldIfNotOther(foodService, 'foodService', 'foodServiceDescription')">
            <option *ngFor="let item of foodService" [ngValue]="item.value">{{item.label}}</option>
          </select>
        </app-field>
      </div>
      <div class="row" *ngIf="getOptionFromValue(foodService, eventForm.get('foodService').value).label === 'Other'">
        <app-field class="col-md-4 col-xs-12" label="Food Service Description" [required]="true"
          [valid]="eventForm.get('foodServiceDescription').valid || !eventForm.get('foodServiceDescription').touched"
          [isFullWidth]="true">
          <textarea class="form-control" formControlName="foodServiceDescription"></textarea>
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Entertainment Provided" [required]="true"
          [valid]="eventForm.get('entertainment').valid || !eventForm.get('entertainment').touched"
          errorMessage="Please enter the entertainment provided" [isFullWidth]="true">
          <select class="form-control" formControlName="entertainment" (change)="clearRelatedFormFieldIfNotOther(entertainment, 'entertainment', 'entertainmentDescription')">
            <option *ngFor="let item of entertainment" [ngValue]="item.value">{{item.label}}</option>
          </select>
        </app-field>
      </div>
      <div class="row" *ngIf="getOptionFromValue(entertainment, eventForm.get('entertainment').value).label === 'Other'">
        <app-field class="col-md-4 col-xs-12" label="Entertainment Description" [required]="true"
          [valid]="eventForm.get('entertainmentDescription').valid || !eventForm.get('entertainmentDescription').touched"
          [isFullWidth]="true">
          <textarea class="form-control" formControlName="entertainmentDescription"></textarea>
        </app-field>
      </div>
    </div>

    <h3 class="blue-header">VENUE LOCATION</h3>
    <div class="padded-section clearfix">
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Venue Name/Description" [required]="true"
          [valid]="eventForm.get('venueDescription').valid || !eventForm.get('venueDescription').touched"
          errorMessage="Please enter the name and a description of the venue" [isFullWidth]="true">
          <textarea class="form-control" formControlName="venueDescription"></textarea>
        </app-field>
        <i style="color: #38598a; margin-left: 5px; margin-top:30px;" class="fas fa-question-circle"
        matTooltip="Provide the name of and briefly describe the venue." ></i>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Location" [required]="true"
          [valid]="eventForm.get('specificLocation').valid || !eventForm.get('specificLocation').touched"
          errorMessage="Please enter the location" [isFullWidth]="true">
          <select class="form-control" formControlName="specificLocation" [compareWith]="compareFn">
            <option *ngFor="let item of specificLocation" [ngValue]="item.value">{{item.label}}</option>
          </select>
        </app-field>
        <i style="color: #38598a; margin-left: 5px; margin-top:30px;" class="fas fa-question-circle"
        matTooltip="Select whether the event is being held indoors, outdoors, or both." ></i>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Additional Information"
          [valid]="eventForm.get('additionalLocationInformation').valid || !eventForm.get('additionalLocationInformation').touched"
          [isFullWidth]="true">
          <textarea class="form-control" formControlName="additionalLocationInformation"></textarea>
        </app-field>
      </div>

      <h3>Physical Address of Venue</h3>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Address 1" [required]="true"
          [valid]="eventForm.get('street1').valid || !eventForm.get('street1').touched"
          errorMessage="Please enter the address line 1" [isFullWidth]="true">
          <input class="form-control" type="text" formControlName="street1">
        </app-field>
        <app-field class="col-md-4 col-xs-12" label="Address 2"
          [valid]="eventForm.get('street2').valid || !eventForm.get('street2').touched"
          [isFullWidth]="true">
          <input class="form-control" type="text" formControlName="street2">
        </app-field>
      </div>
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="City" [required]="true"
          [valid]="eventForm.get('city').valid || !eventForm.get('city').touched"
          errorMessage="Please enter the city" [isFullWidth]="true">
          <input class="form-control" type="text" formControlName="city">
        </app-field>
        <app-field class="col-md-4 col-xs-12" label="Postal Code" [required]="true"
          [valid]="eventForm.get('postalCode').valid || !eventForm.get('postalCode').touched"
          errorMessage="Please enter the postal code" [isFullWidth]="true">
          <input class="form-control" type="text" formControlName="postalCode">
        </app-field>
      </div>
    </div>

    <h3 class="blue-header">TIME AND DATE OF EVENT</h3>
    <div class="padded-section clearfix">
      <div class="row">
        <app-field class="col-md-4 col-xs-12" label="Start Date" [required]="true"
          [valid]="eventForm.get('startDate').valid || !eventForm.get('startDate').touched"
          [isFullWidth]="false">
          <input type="text" formControlName='startDate'
            style="width: 200px; background-color: #fff;" placeholder="yyyy-mm-dd" class="form-control"
            [min]="startDateMinimum" [matDatepicker]="startPicker" (focus)="startPicker.open()" (click)="startPicker.open()"
            (dateChange)="startDateChanged()">
          <mat-datepicker #startPicker></mat-datepicker>
        </app-field>
        <app-field class="col-md-4 col-xs-12" label="End Date" [required]="true"
          [valid]="eventForm.get('endDate').valid || !eventForm.get('endDate').touched"
          [isFullWidth]="false">
          <input type="text" formControlName='endDate'
            style="width: 200px; background-color: #fff;" placeholder="yyyy-mm-dd" class="form-control"
            [min]="endDateMinimum" [matDatepicker]="endPicker" (focus)="endPicker.open()" (click)="endPicker.open()"
            [max]="endDateMaximum" (dateChange)="endDateChanged()">
          <mat-datepicker #endPicker></mat-datepicker>
        </app-field>
      </div>
      <div *ngFor="let form of timeForms.controls" class="row mr-0 mt-3" style="background-color: #E1E8F2; border-bottom: 4px solid #E4E4E4">
        <form [formGroup]="form" class="col-md-12">
          <div class="row mt-3">
            <div class="col-md-2 offset-md-2"><label>Event Start</label></div>
            <div class="col-md-2"><label>Event End</label></div>
            <div class="col-md-2"><label>Liquor Service Start</label></div>
            <div class="col-md-2"><label>Liquor Service End</label></div>
          </div>
          <div class="row">
            <div class="col-md-2 time-picker-title">
              <h4>{{form.get('dateTitle').value === null ? 'Default Times' : form.get('dateTitle').value}}</h4>
            </div>
            <div class="col-md-2">
              <ngb-timepicker [meridian]="true" formControlName="startTime"></ngb-timepicker>
            </div>
            <div class="col-md-2">
              <ngb-timepicker [meridian]="true" formControlName="endTime"></ngb-timepicker>
            </div>
            <div class="col-md-2">
              <ngb-timepicker [meridian]="true" formControlName="liquorStartTime"></ngb-timepicker>
            </div>
            <div class="col-md-2">
              <ngb-timepicker [meridian]="true" formControlName="liquorEndTime"></ngb-timepicker>
            </div>
          </div>
        </form>
      </div>
      <div class="row">
        <app-field class="col-xs-12">
          <mat-checkbox [checked]="scheduleIsInconsistent" (change)="toggleScheduleConsistency()" [disabled]="eventForm.controls['startDate'].invalid || eventForm.controls['endDate'].invalid ">The event and liquor service times are different on specific dates.</mat-checkbox>
        </app-field>
      </div>
    </div>

    <h3 class="blue-header">AGREEMENT</h3>
    <div class="padded-section">
      <p>A person commits an offence if the person provides false or misleading information in the following circumstances: (i) when making an application referred to in section 12; (ii) when making a report or when required and as specified by the general manager under section 59. - Liquor Control and Licensing Act, Section 57(1)(c).</p>
      <p>The Branch may cancel a catering authorization if:</p>
      <ul>
        <li>The event circumstances which the authorization was based on change and no longer meet the requirements of the Act or regulation;</li>
        <li>The event circumstances which the authorization was based on did not exist at the time the catering authorization was issued; or</li>
        <li>The catering authorization was issued in error.</li>
      </ul>
      <p>- Liquor Control and Licensing Act, Section 50.</p>
      <div>
        <mat-checkbox formControlName="agreement">I understand and agree to abide by the terms and conditions of the catering authorization.</mat-checkbox>
      </div>
    </div>

    <div class="p-3" style="background-color: #E1E8F2; border-bottom: 4px solid #E4E4E4">
      <p>The information requested on this form is collected by the Liquor and Cannabis Regulation Branch under Section 26 (a) and (c) of the Freedom of Information and Protection of Privacy Act and will be used for the purpose of liquor licensing and compliance and enforcement matters in accordance with the Liquor Control and Licensing Act. Should you have any questions about the collection, use, or disclosure of personal information, please contact the Freedom of Information Officer at PO Box 9292 STN PROV GVT, Victoria, BC, V8W 9J8 or by phone toll free at 1-866-209-2111.</p>
    </div>

    <div class="p-4 button-row">
      <button class="btn btn-primary" style="margin-right:10px;" (click)="save(false);">
        <span>
          <i class="fa fa-save" style="color: #fff;"></i>
          SAVE FOR LATER
        </span>
      </button>
      <button class="btn btn-primary" style="margin-right:10px;" (click)="cancel();">
        <span>
          <i class="fa fa-trash" style="color: #fff;"></i>
          CANCEL
        </span>
      </button>
      <button class="btn btn-primary" (click)="save(true)" [disabled]="isFormValid()">SUBMIT</button>
    </div>
  </form>
</div>
