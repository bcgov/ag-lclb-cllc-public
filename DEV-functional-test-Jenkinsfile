// Functional test


podTemplate(label: 'agent-dotnet', name: 'agent-dotnet', serviceAccount: 'jenkins', cloud: 'openshift', containers: [
    containerTemplate(
        name: 'jnlp',
        image: '172.50.0.2:5000/yuumcs/agent-dotnet',
        resourceRequestCpu: '500m',
        resourceLimitCpu: '1000m',
        resourceRequestMemory: '3Gi',
        resourceLimitMemory: '4Gi',
        workingDir: '/home/jenkins',
        command: '',
        args: '${computer.jnlpmac} ${computer.name}'
    )
]) {
    stage('BDD Test') {
        node('owasp-zap2') {
            //the checkout is mandatory
            echo "checking out source"
            echo "Build: ${BUILD_ID}"
            checkout scm

            dir('functional-tests\bdd-tests') {               
				try {
					set
					dotnet restore
					dotnet test --logger "junit;LogFilePath=functionalResults.xml"					
				}
                finally {
					junit 'functionalResults.xml'
				}
            }
        }
    }
}
